<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Fórum | Sustentabilidade Tapera</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark fixed-top" style="background-color: var(--dark-color);">
    <div class="container-fluid">
        <a class="navbar-brand fw-bold" href="index.html">
            <img src="img/Logo.png" class="navbar-logo">
            Sustentabilidade Tapera
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item"><a class="nav-link" href="index.html">Início</a></li>
                <li class="nav-item"><a class="nav-link" href="denuncia.html">Denúncia</a></li>
                <li class="nav-item"><a class="nav-link active" href="forum.html">Fórum</a></li>
                <li class="nav-item"><a class="nav-link" href="perfil.html">Perfil</a></li>
            </ul>
        </div>
    </div>
</nav>

<main class="container py-5 mt-5">
    <h2 class="mb-4 text-primary">
        <i class="bi bi-chat-dots-fill"></i> Fórum Comunitário
    </h2>

    <!-- FORMULÁRIO CRIAR TÓPICO -->
    <div class="card p-4 mb-5 shadow-sm">
        <h5>Criar Novo Tópico</h5>
        <form id="formTopico">

            <div class="mb-3">
                <label>Título do Tópico</label>
                <input type="text" id="tituloTopico" class="form-control" required>
            </div>

            <div class="mb-3">
                <label>Mensagem</label>
                <textarea id="conteudoTopico" class="form-control" rows="3" required></textarea>
            </div>

            <button type="submit" class="btn btn-primary w-100">
                <i class="bi bi-pencil-square"></i> Publicar Tópico
            </button>

        </form>
    </div>

    <!-- LISTA DE TÓPICOS -->
    <h5>Tópicos Publicados</h5>
    <div id="listaTopicos"></div>

</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
const STORAGE_TOPICOS = "topicosForum";
const form = document.getElementById("formTopico");
const listaTopicos = document.getElementById("listaTopicos");

function carregarTopicos() {
    const topicos = JSON.parse(localStorage.getItem(STORAGE_TOPICOS)) || [];
    listaTopicos.innerHTML = "";

    if (topicos.length === 0) {
        listaTopicos.innerHTML = "<p class='text-muted'>Nenhum tópico ainda.</p>";
        return;
    }

    topicos.slice().reverse().forEach((topico) => {
        const div = document.createElement("div");
        div.className = "card mb-3 shadow-sm";

        div.innerHTML = `
        <div class="card-body">
            <h5>${topico.titulo}</h5>
            <p>${topico.conteudo}</p>
            <small class="text-muted">Publicado em: ${topico.data}</small>
            <br>
            <button class="btn btn-sm btn-outline-danger mt-2 btn-excluir" data-id="${topico.id}">
                <i class="bi bi-trash"></i> Excluir
            </button>
        </div>
        `;

        listaTopicos.appendChild(div);
    });
}

form.addEventListener("submit", function(e) {
    e.preventDefault();

    const titulo = document.getElementById("tituloTopico").value.trim();
    const conteudo = document.getElementById("conteudoTopico").value.trim();

    if (!titulo || !conteudo) {
        alert("Preencha todos os campos.");
        return;
    }

    const novoTopico = {
        id: Date.now(),
        titulo,
        conteudo,
        data: new Date().toLocaleString("pt-BR")
    };

    let topicos = JSON.parse(localStorage.getItem(STORAGE_TOPICOS)) || [];
    topicos.push(novoTopico);
    localStorage.setItem(STORAGE_TOPICOS, JSON.stringify(topicos));

    alert("Tópico publicado com sucesso!");

    form.reset();
    carregarTopicos();
});

listaTopicos.addEventListener("click", function(e) {
    const botao = e.target.closest(".btn-excluir");
    if (!botao) return;

    const id = Number(botao.dataset.id);
    let topicos = JSON.parse(localStorage.getItem(STORAGE_TOPICOS)) || [];

    topicos = topicos.filter(t => t.id !== id);
    localStorage.setItem(STORAGE_TOPICOS, JSON.stringify(topicos));

    carregarTopicos();
});

document.addEventListener("DOMContentLoaded", carregarTopicos);
</script>

</body>
</html>
