<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Perfil do Usuário | Sustentabilidade Tapera</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap / Ícones / Seu CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-dark fixed-top" style="background-color: var(--dark-color);">
    <div class="container-fluid">
        <a class="navbar-brand fw-bold" href="index.html">
            <img src="img/Logo.png" alt="Logo Tapera ODS 6" class="navbar-logo">
            Sustentabilidade Tapera
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item"><a class="nav-link" href="index.html">Início</a></li>
                <li class="nav-item"><a class="nav-link" href="denuncia.html">Denúncia</a></li>
                <li class="nav-item"><a class="nav-link" href="infoMap.html">Mapa</a></li>
                <li class="nav-item"><a class="nav-link" href="forum.html">Fórum</a></li>
                <li class="nav-item"><a class="nav-link active" href="perfil.html">Perfil</a></li>
            </ul>
        </div>
    </div>
</nav>

<main class="secondary-page-content">
    <div class="container py-5">
        <h1 class="fw-bold mb-4 text-primary">
            <i class="bi bi-person-circle me-2"></i> Perfis de Usuário
        </h1>
        <p class="lead">Cadastre e gerencie os perfis dos moradores que utilizam o sistema.</p>

        <div class="row">
            <!-- FORMULÁRIO DE PERFIL -->
            <div class="col-lg-8">
                <div class="card p-4 shadow-sm">
                    <h4 class="card-title mb-3">Criar / Editar Perfil</h4>

                    <form id="perfilForm">
                        <!-- campo oculto para saber se é edição -->
                        <input type="hidden" id="perfilId">

                        <div class="mb-3">
                            <label for="nomePerfil" class="form-label">Nome completo</label>
                            <input type="text" class="form-control" id="nomePerfil" required>
                        </div>

                        <div class="mb-3">
                            <label for="emailPerfil" class="form-label">E-mail</label>
                            <input type="email" class="form-control" id="emailPerfil" required>
                        </div>

                        <div class="mb-3">
                            <label for="telefonePerfil" class="form-label">Telefone</label>
                            <input type="tel" class="form-control" id="telefonePerfil" placeholder="(xx) xxxxx-xxxx">
                        </div>

                        <div class="mb-3">
                            <label for="bairroPerfil" class="form-label">Bairro</label>
                            <input type="text" class="form-control" id="bairroPerfil">
                        </div>

                        <button type="submit" class="btn btn-primary w-100">
                            <i class="bi bi-save me-2"></i> Salvar Perfil
                        </button>
                    </form>
                </div>
            </div>

            <!-- LISTA DE PERFIS CADASTRADOS -->
            <div class="col-lg-4 mt-4 mt-lg-0">
                <div class="card p-3 shadow-sm" style="background-color: var(--light-color);">
                    <h5 class="card-title text-dark fw-bold mb-3">Perfis cadastrados</h5>
                    <ul id="listaPerfis" class="list-group list-group-flush">
                        <!-- preenchido via JavaScript -->
                    </ul>
                </div>
            </div>
        </div>

    </div>
</main>

<footer class="py-4 text-white" style="background-color: var(--dark-color);">
    <div class="container">
        <p class="mb-0">&copy; 2024 Projeto Sustentabilidade Tapera - ODS 6. Todos os direitos reservados.</p>
        <p class="mb-0 small">Desenvolvido pelos alunos de ADS - UniSENAI.</p>
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
const STORAGE_PERFIS = 'perfisTapera';
const formPerfil = document.getElementById('perfilForm');
const listaPerfis = document.getElementById('listaPerfis');
const inputId = document.getElementById('perfilId');
const inputNome = document.getElementById('nomePerfil');
const inputEmail = document.getElementById('emailPerfil');
const inputTelefone = document.getElementById('telefonePerfil');
const inputBairro = document.getElementById('bairroPerfil');

// ----- FUNÇÕES DE LOCALSTORAGE -----
function obterPerfis() {
    try {
        return JSON.parse(localStorage.getItem(STORAGE_PERFIS)) || [];
    } catch (e) {
        console.error('Erro ao ler perfis', e);
        return [];
    }
}

function salvarPerfis(perfis) {
    localStorage.setItem(STORAGE_PERFIS, JSON.stringify(perfis));
}

// ----- RENDERIZAR LISTA -----
function renderizarPerfis() {
    const perfis = obterPerfis();
    listaPerfis.innerHTML = '';

    if (!perfis.length) {
        listaPerfis.innerHTML = `
            <li class="list-group-item text-muted">
                Nenhum perfil cadastrado ainda.
            </li>
        `;
        return;
    }

    perfis.slice().reverse().forEach(perfil => {
        const li = document.createElement('li');
        li.className = 'list-group-item d-flex justify-content-between align-items-start';

        li.innerHTML = `
            <div>
                <strong>${perfil.nome}</strong><br>
                <small class="text-muted">
                    ${perfil.email || 'Sem e-mail'}<br>
                    ${perfil.telefone || ''} ${perfil.bairro ? ' · ' + perfil.bairro : ''}
                </small>
            </div>
            <div class="ms-2 d-flex flex-column gap-1">
                <button class="btn btn-sm btn-outline-primary btn-editar-perfil" data-id="${perfil.id}">
                    <i class="bi bi-pencil"></i>
                </button>
                <button class="btn btn-sm btn-outline-danger btn-excluir-perfil" data-id="${perfil.id}">
                    <i class="bi bi-trash"></i>
                </button>
            </div>
        `;

        listaPerfis.appendChild(li);
    });
}

// ----- LIMPAR FORMULÁRIO -----
function limparFormulario() {
    inputId.value = '';
    formPerfil.reset();
}

// ----- SUBMIT (CRIAR / EDITAR) -----
formPerfil.addEventListener('submit', function(e) {
    e.preventDefault();

    const nome = inputNome.value.trim();
    const email = inputEmail.value.trim();
    const telefone = inputTelefone.value.trim();
    const bairro = inputBairro.value.trim();
    const idExistente = inputId.value;

    if (!nome || !email) {
        alert('Preencha pelo menos Nome e E-mail.');
        return;
    }

    let perfis = obterPerfis();

    if (idExistente) {
        // edição
        const idNum = Number(idExistente);
        perfis = perfis.map(p => 
            p.id === idNum 
                ? { ...p, nome, email, telefone, bairro }
                : p
        );
        alert('Perfil atualizado com sucesso!');
    } else {
        // novo cadastro
        const novoPerfil = {
            id: Date.now(),
            nome,
            email,
            telefone,
            bairro
        };
        perfis.push(novoPerfil);
        alert('Perfil cadastrado com sucesso!');
    }

    salvarPerfis(perfis);
    limparFormulario();
    renderizarPerfis();
});

// ----- CLIQUES NA LISTA (EDITAR / EXCLUIR) -----
listaPerfis.addEventListener('click', function(e) {
    const btnEditar = e.target.closest('.btn-editar-perfil');
    const btnExcluir = e.target.closest('.btn-excluir-perfil');

    if (btnEditar) {
        const id = Number(btnEditar.dataset.id);
        const perfis = obterPerfis();
        const perfil = perfis.find(p => p.id === id);
        if (!perfil) return;

        // Preenche o formulário para edição
        inputId.value = perfil.id;
        inputNome.value = perfil.nome;
        inputEmail.value = perfil.email;
        inputTelefone.value = perfil.telefone || '';
        inputBairro.value = perfil.bairro || '';

        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    if (btnExcluir) {
        const id = Number(btnExcluir.dataset.id);
        let perfis = obterPerfis();
        perfis = perfis.filter(p => p.id !== id);
        salvarPerfis(perfis);
        renderizarPerfis();
    }
});

// Inicializa a lista ao abrir a página
document.addEventListener('DOMContentLoaded', renderizarPerfis);
</script>

</body>
</html>
